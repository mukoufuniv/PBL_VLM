import cv2

# -------------------------------------------------------------------
# ▼▼▼▼▼ ここに、あなたのスマートフォンのIPカメラアプリが表示したURLを入力してください ▼▼▼▼▼
# 例: 'http://192.168.1.5:8080/video'
VIDEO_STREAM_URL = 'http://192.168.11.6:8080/video'
# ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲

def main():
    """指定されたURLのカメラ映像を表示するテストプログラム"""

    print(f"接続先のURL: {VIDEO_STREAM_URL}")
    print("カメラに接続を試みています...")

    # カメラに接続
    cap = cv2.VideoCapture(VIDEO_STREAM_URL)

    # 接続チェック
    if not cap.isOpened():
        print("--------------------------------------------------")
        print("エラー: カメラに接続できませんでした。")
        print("以下の点を確認してください：")
        print("  1. URLが正しいか（コピー＆ペーストがおすすめです）")
        print("  2. スマートフォンとPCが同じWi-Fiに接続されているか")
        print("  3. スマートフォンのIPカメラアプリでサーバーが起動しているか")
        print("  4. PCのファイアウォールが接続をブロックしていないか")
        print("--------------------------------------------------")
        return

    print("接続に成功しました！")
    print("映像ウィンドウが表示されます。'q'キーを押すと終了します。")

    # メインループ
    while True:
        # カメラから1フレーム読み込む
        ret, frame = cap.read()

        # フレームが正しく読み込めなかった場合はループを抜ける
        if not ret:
            print("エラー: 映像ストリームからフレームを読み込めませんでした。接続が切れた可能性があります。")
            break

        # "Camera Test Feed"という名前のウィンドウに映像を表示
        cv2.imshow('Camera Test Feed', frame)

        # 'q'キーが押されたらループを抜けて終了する
        if cv2.waitKey(1) & 0xFF == ord('q'):
            break

    # 後処理
    print("テストプログラムを終了します。")
    cap.release()          # カメラを解放
    cv2.destroyAllWindows()  # すべてのウィンドウを閉じる

if __name__ == '__main__':
    main()